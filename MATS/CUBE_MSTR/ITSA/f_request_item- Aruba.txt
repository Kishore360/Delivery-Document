SELECT CASE WHEN max_count<>min_count THEN 'FAILURE' ELSE 'SUCCESS' END as Result,
 CASE WHEN  max_count<>min_count THEN 'OOTB has Keys Dropped' ELSE 'SUCCESS'  END as Message FROM (
 select max(Row_Count) max_count,Min(Row_Count) min_count from (

select  'f_request_item' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11

UNION

select  'd_internal_contact' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_internal_contact	a12
on 	(a11.opened_by_key = a12.row_key)

UNION

select  'd_master_item' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_master_item	a13
on 	(a11.catalog_item_key = a13.row_key)

UNION

select  'd_calendar_date_closed' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_calendar_date_closed	a14
on 	(a11.closed_on_key = a14.row_key)

UNION

select  'd_calendar_date' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_calendar_date	a15
on 	(a11.opened_on_key = a15.row_key)

UNION

select  'd_calendar_month_closed' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_calendar_date_closed	a14
on 	(a11.closed_on_key = a14.row_key)
join	ldb.d_calendar_month_closed	a16
on 	(a14.month_start_date_key = a16.row_key)             


UNION

select  'd_calendar_month' as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_calendar_date	a15
on 	(a11.opened_on_key = a15.row_key)
join	ldb.d_calendar_month	a17
on 	(a15.month_start_date_key = a17.row_key)

UNION
            
select 'd_request_item'as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_request_item	a18
on 	(a11.request_item_key = a18.row_key)

UNION

select 'd_request_item_state'as Table_Name,count(a11.row_key) Row_Count
from      ldb.f_request_item a11
join	ldb.d_request_item_state	a19
on 	(a11.state_src_key = a19.row_key)


)a
)b



