

SELECT 
CASE WHEN CNT > 0 THEN 'FAILURE' ELSE 'SUCCESS' END as Result,
CASE WHEN CNT > 0 THEN 'MDS to DWH data validation failed for d_rita_application_c.automated_decision_making_flag' ELSE 'SUCCESS' END as Message
FROM 
(
SELECT Count(1) as CNT 
FROM pandg_mdsdb.pg_mega_pgb_application_rita_final SRC 
LEFT JOIN pandg_mdwdb.d_rita_application_c TRGT ON SRC.NAME=TRGT.row_id AND SRC.sourceinstance=TRGT.source_id
WHERE 
CASE 
WHEN SRC.AUTOMATED_DECISION_MAKING ='y'
OR SRC.AUTOMATED_DECISION_MAKING ='Y'
OR SRC.AUTOMATED_DECISION_MAKING ='YES'
OR SRC.AUTOMATED_DECISION_MAKING ='yes'
THEN 'Y'
WHEN SRC.AUTOMATED_DECISION_MAKING ='n'
OR SRC.AUTOMATED_DECISION_MAKING ='N'
OR SRC.AUTOMATED_DECISION_MAKING ='NO'
OR SRC.AUTOMATED_DECISION_MAKING ='no'
THEN 'N' 
WHEN SRC.AUTOMATED_DECISION_MAKING IS NULL 
THEN 'UNSPECIFIED'
ELSE 'N' END <> TRGT.automated_decision_making_flag
) temp;


