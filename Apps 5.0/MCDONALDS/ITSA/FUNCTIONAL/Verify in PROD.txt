--AG MANAGER MONTHLY @@@

FAILURE PROBABILITY :

select (a.a/b.b)*100.0 as failure_probability from 
(select count(1)  a from (
select assignment_gp_manager_key,month_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- month_start_key between '20171201' and '20180131'
where  month_start_key>=20180101 and month_start_key<=20180305
group by assignment_gp_manager_key,month_start_key)a where expected_ending<>ending)a
 cross join 
 (select count(1)  b from (
select assignment_gp_manager_key,month_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- month_start_key between '20171201' and '20180131'
where  month_start_key>=20180101 and month_start_key<=20180305
group by assignment_gp_manager_key,month_start_key)c)b									
									
									
									
									
									
									
									
									
									





 MANAGER ,WEEK LEVEL 																	
		select * from (
select assignment_gp_manager_key,assignment_group_key,month_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- month_start_key between '20171201' and '20180131'
where  month_start_key>=20180101 and month_start_key<=20180305
group by assignment_gp_manager_key,assignment_group_key,month_start_key)a where expected_ending<>ending;															
																	
																	
																	
																	
																	
																	
																	
																	
																	
																	
AGE_KEY																	
																	
		select assignment_group_key,assignment_gp_manager_key,priority_src_key,business_service_key,month_start_key,floor((age/86400)/ending_backlog) as  age_populated ,
case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end age_key_expected ,age_key age_key_actual
     from  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
     join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
     where   case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end <>age_key
     group by a.assignment_group_key,assignment_gp_manager_key,priority_src_key,business_service_key,month_start_key;															
																	
																	
																	
																	
																	
																	
																	
																	
																	
																	
																	
PREV AGE 																	
		select a.assignment_group_key,a.assignment_gp_manager_key,a.priority_src_key,b.business_service_key,a.month_start_key,b.prev_month_start_key,coalesce(age,0),coalesce(prev_age,0) from (
select assignment_group_key,assignment_gp_manager_key ,priority_src_key,business_service_key,prev_month_start_key, month_start_key,sum(age/86400) age
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
   join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
where  month_start_key>=20180101 and month_start_key<=20180305
group by 1 ,2,3,4,5 )a 
join (
select assignment_group_key,assignment_gp_manager_key, priority_src_key,business_service_key, prev_month_start_key,month_start_key,sum((prev_age/86400)) prev_age
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c
   join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
where  prev_month_start_key>=20180101 and prev_month_start_key<=20180305
group by 1 ,2,3,4,5)b 
on  a.month_start_key=b.prev_month_start_key 
where a.assignment_gp_manager_key=b.assignment_gp_manager_key 
and a.assignment_group_key=b.assignment_group_key
and  a.priority_src_key=b.priority_src_key
and a.business_service_key=b.business_service_key
 -- and prev_age not in (0) and
and  (age)<>(prev_age) ;															
																	
																	
																	
																	
																	
																	
																	
																	
																	
																	
																	
PREV WEEK ENDING  AND THIS WEEK BEGINNING MATCH 																	
																	
select a.assignment_group_key,a.assignment_gp_manager_key,a.month_start_key,b.prev_month_start_key,ending,beg from (
select assignment_group_key,assignment_gp_manager_key  ,prev_month_start_key, month_start_key,sum(ending_backlog) ending
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  month_start_key>=20180101 and month_start_key<=20180305
group by 1,2,3,4 )a 
join (
select assignment_group_key,assignment_gp_manager_key, prev_month_start_key,month_start_key,sum(beginning_backlog) beg  
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  prev_month_start_key>=20180101 and prev_month_start_key<=20180305
group by 1 ,2,3,4)b 
on  a.month_start_key=b.prev_month_start_key AND a.assignment_gp_manager_key=b.assignment_gp_manager_key  
AND a.assignment_group_key = b.assignment_group_key
WHERE ending <> beg;																	
																	
																	
																	
																	
																	
																	
																	
																	
BEGINNING AND PREV BEGINNING BACKLOG																	
																	
select a.assignment_gp_manager_key,a.month_start_key,b.prev_month_start_key,begining,prev_begining_backlog from (
select assignment_gp_manager_key, month_start_key,sum(beginning_backlog) begining 
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
 join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
 where month_start_key>=20180101 and month_start_key<=20180305
group by 1 ,2 )a 
join (
select assignment_gp_manager_key  , prev_month_start_key,sum(prev_beginning_backlog) prev_begining_backlog   
FROM       mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
 join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
 where month_start_key>=20180101 and month_start_key<=20180305
group by 1 ,2)b 
on  a.month_start_key=b.prev_month_start_key and 
-- a.assignment_group_key=b.assignment_group_key and 
a.assignment_gp_manager_key=b.assignment_gp_manager_key  where begining<>prev_begining_backlog;																	
																	
																	
																	
																	
																	
																	
																	
																	
ENDING AND PREV ENDING BACKLOG																	
																	
select a.assignment_group_key,a.assignment_gp_manager_key  ,a.month_start_key,b.prev_month_start_key,ending,prev_ending_backlog from (
select assignment_group_key,assignment_gp_manager_key   ,prev_month_start_key, month_start_key,sum(ending_backlog) ending 
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  month_start_key>=20180101 and month_start_key<=20180305
group by 1 ,2,3,4 )a 
join (
select assignment_group_key,assignment_gp_manager_key  , prev_month_start_key,month_start_key,sum(prev_ending_backlog) prev_ending_backlog  
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_monthly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  month_start_key>=20180101 and month_start_key<=20180305
group by 1 ,2,3,4)b 
on  a.month_start_key=b.prev_month_start_key 
AND a.assignment_group_key=b.assignment_group_key    
AND a.assignment_gp_manager_key=b.assignment_gp_manager_key    
WHERE ending <>prev_ending_backlog;																	
																	
																	
-- AG MANAGER WEEKLY @@@@


MANAGER ,WEEK LEVEL 																
		select * from (
select assignment_gp_manager_key,assignment_group_key,week_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- week_start_key between '20171201' and '20180131'
where  week_start_key>=20180101 and week_start_key<=20180305
group by assignment_gp_manager_key,assignment_group_key,week_start_key)a where expected_ending<>ending;														
																
																
																
																
																
																
																
																
																
																
AGE_KEY																
																
		select assignment_group_key,assignment_gp_manager_key,priority_src_key,business_service_key,week_start_key,floor((age/86400)/ending_backlog) as  age_populated ,
case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end age_key_expected ,age_key age_key_actual
     from  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
     join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
     where   case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end <>age_key
     group by a.assignment_group_key,assignment_gp_manager_key,priority_src_key,business_service_key,week_start_key;														
																
																
																
																
																
																
																
																
																
																
																
PREV AGE 																
		select a.assignment_group_key,a.assignment_gp_manager_key,a.priority_src_key,b.business_service_key,a.week_start_key,b.prev_week_start_key,coalesce(age,0),coalesce(prev_age,0) from (
select assignment_group_key,assignment_gp_manager_key ,priority_src_key,business_service_key,prev_week_start_key, week_start_key,sum(age/86400) age
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
   join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
where  week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3,4,5 )a 
join (
select assignment_group_key,assignment_gp_manager_key, priority_src_key,business_service_key, prev_week_start_key,week_start_key,sum((prev_age/86400)) prev_age
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
   join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
where  prev_week_start_key>=20180101 and prev_week_start_key<=20180305
group by 1 ,2,3,4,5)b 
on  a.week_start_key=b.prev_week_start_key 
where a.assignment_gp_manager_key=b.assignment_gp_manager_key 
and a.assignment_group_key=b.assignment_group_key
and  a.priority_src_key=b.priority_src_key
and a.business_service_key=b.business_service_key
 -- and prev_age not in (0) and
and  (age)<>(prev_age) ;
														
																
																
																
																
																
																
																
																
																
																
																
PREV WEEK ENDING  AND THIS WEEK BEGINNING MATCH 																
																
select a.assignment_group_key,a.assignment_gp_manager_key,a.week_start_key,b.prev_week_start_key,ending,beg from (
select assignment_group_key,assignment_gp_manager_key  ,prev_week_start_key, week_start_key,sum(ending_backlog) ending
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  week_start_key>=20180101 and week_start_key<=20180305
group by 1,2,3,4 )a 
join (
select assignment_group_key,assignment_gp_manager_key, prev_week_start_key,week_start_key,sum(beginning_backlog) beg  
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  prev_week_start_key>=20180101 and prev_week_start_key<=20180305
group by 1 ,2,3,4)b 
on  a.week_start_key=b.prev_week_start_key AND a.assignment_gp_manager_key=b.assignment_gp_manager_key  
AND a.assignment_group_key = b.assignment_group_key
WHERE ending <> beg;																
																
																
																
																
																
																
																
																
BEGINNING AND PREV BEGINNING BACKLOG																
																
select a.assignment_group_key,a.assignment_gp_manager_key,a.week_start_key,b.prev_week_start_key,begining,prev_begining_backlog from (
select assignment_group_key,assignment_gp_manager_key, week_start_key,sum(beginning_backlog) begining 
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
 join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
 where week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3 )a 
join (
select assignment_group_key,assignment_gp_manager_key  , prev_week_start_key,sum(prev_beginning_backlog) prev_begining_backlog   
FROM       mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
 join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
 where week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3)b 
on  a.week_start_key=b.prev_week_start_key and 
a.assignment_group_key=b.assignment_group_key and 
a.assignment_gp_manager_key=b.assignment_gp_manager_key  where begining<>prev_begining_backlog;																
																
																
																
																
																
																
																
																
ENDING AND PREV ENDING BACKLOG																
																
select a.week_start_key,b.prev_week_start_key,ending,prev_ending_backlog from (
select assignment_gp_manager_key,prev_week_start_key, week_start_key,sum(ending_backlog) ending 
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3 )a 
join (
select assignment_gp_manager_key, prev_week_start_key,week_start_key,sum(prev_ending_backlog) prev_ending_backlog  
FROM     mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c a11
join mcdonalds_mdwdb.d_internal_contact a13 on a11.assignment_gp_manager_key=a13.row_key
where  week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3)b 
on  a.week_start_key=b.prev_week_start_key 
-- AND a.assignment_group_key=b.assignment_group_key    
AND a.assignment_gp_manager_key=b.assignment_gp_manager_key    
WHERE ending <>prev_ending_backlog;																
																
																
FAILURE PROBABILITY :
---------------------
select (a.a/b.b)*100.0 as failure_probability from 
(select count(1)  a from (
select assignment_gp_manager_key,assignment_group_key,week_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- week_start_key between '20171201' and '20180131'
where  week_start_key>=20180101 and week_start_key<=20180305
group by assignment_gp_manager_key,assignment_group_key,week_start_key)a where expected_ending<>ending)a
 cross join 
 (select count(1)  b from (
select assignment_gp_manager_key,assignment_group_key,week_start_key,sum(inflow_count),sum(beginning_backlog),sum(outflow_count)outflow,sum(resolved) ,
sum(ending_backlog) ending ,
((sum(beginning_backlog)+sum(inflow_count))-(sum(outflow_count)+sum(resolved))) expected_ending,
(sum(beginning_backlog)+sum(inflow_count)) as validate,
(sum(outflow_count)+sum(resolved)) as validate2,
count(1) FROM  mcdonalds_mdwdb.f_n_incident_agm_io_snapshot_weekly_c
join mcdonalds_mdwdb.d_internal_contact a13 on assignment_gp_manager_key=a13.row_key
-- where   assignment_group_key='11713' and 
-- week_start_key between '20171201' and '20180131'
where  week_start_key>=20180101 and week_start_key<=20180305
group by assignment_gp_manager_key,assignment_group_key,week_start_key)c)b		



-- Vendor weekly @@@@

AGE_KEY														
														
select  a12.full_name,a12.vendor_name_c, grouped_vendor_name_c, priority_src_key,business_service_key,week_start_key,floor((age/86400)/ending_backlog) as  age_populated ,
case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end age_key_expected ,age_key age_key_actual
     from  mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
      Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
     where   case when floor((age/86400)/ending_backlog) between 0 and 4 then 70624
     when floor((age/86400)/ending_backlog)  between 5 and 7 then 70619
     when floor((age/86400)/ending_backlog)  between 8 and 14 then 70620
     when floor((age/86400)/ending_backlog)  between 15 and 28 then 70621
     when floor((age/86400)/ending_backlog)  between 29 and 60 then 70622
     when floor((age/86400)/ending_backlog)  between 61 and 1000000 then 70623 end <>age_key
     group by  a12.full_name,a12.vendor_name_c, grouped_vendor_name_c, priority_src_key,business_service_key,week_start_key;														
														
														
														
														
														
														
														
														
PREV WEEK ENDING  AND THIS WEEK BEGINNING MATCH 														
														
     select a.assigned_to_key,a.vendor_name_c, a.grouped_vendor_name_c,a.week_start_key,b.prev_week_start_key,ending,beg from (
select assigned_to_key,a12.vendor_name_c, a12.grouped_vendor_name_c, prev_week_start_key, week_start_key,sum(ending_backlog) ending
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180305
group by 1 ,2,3,4,5 )a 
join (
select assigned_to_key,a12.vendor_name_c, a12.grouped_vendor_name_c,  prev_week_start_key,week_start_key,sum(beginning_backlog) beg   
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  prev_week_start_key>=20180101 and prev_week_start_key<=20180305
group by 1 ,2,3,4,5)b 
on   a.assigned_to_key=b.assigned_to_key and a.week_start_key=b.prev_week_start_key where ending<>beg														
														
														
														
														
														
														
														
														
														
BEGINNING AND PREV BEGINNING BACKLOG														
														
select a.assigned_to_key,a.vendor_name_c, a.grouped_vendor_name_c,a.week_start_key,b.prev_week_start_key,begining,prev_begining_backlog from (
select assigned_to_key assigned_to_key,a12.vendor_name_c vendor_name_c, a12.grouped_vendor_name_c grouped_vendor_name_c,  week_start_key,sum(beginning_backlog) begining 
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180305 
group by 1 ,2,3,4 )a 
join (
select assigned_to_key ,a12.vendor_name_c vendor_name_c, a12.grouped_vendor_name_c grouped_vendor_name_c,  prev_week_start_key,sum(prev_beginning_backlog) prev_begining_backlog   
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180305 
group by 1 ,2,3,4)b 
on  a.week_start_key=b.prev_week_start_key and a.assigned_to_key=b.assigned_to_key  
 and a.week_start_key>=20180101 and a.week_start_key<=20180305  
 where begining<>prev_begining_backlog;														
														
														
														
														
														
														
														
														
ENDING AND PREV ENDING BACKLOG														
														
select a.assigned_to_key,a.vendor_name_c, a.grouped_vendor_name_c,a.week_start_key,b.prev_week_start_key,ending,prev_ending_backlog from (
select assigned_to_key,a12.vendor_name_c, a12.grouped_vendor_name_c, prev_week_start_key, week_start_key,sum(ending_backlog) ending 
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180305 
group by 1 ,2,3,4,5 )a 
join (
select assigned_to_key,a12.vendor_name_c, a12.grouped_vendor_name_c,  prev_week_start_key,week_start_key,sum(prev_ending_backlog) prev_ending_backlog   
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180305 
group by 1 ,2,3,4,5)b 
on  a.week_start_key=b.prev_week_start_key where a.assigned_to_key=b.assigned_to_key and ending<>prev_ending_backlog;														
														
														
														
														
														
														
														
														
PREV AGE 														
														
select a.*,b.prev_age from
(select assigned_to_key,a12.full_name,a12.vendor_name_c, a12.grouped_vendor_name_c  ,priority_src_key,business_service_key,prev_week_start_key, week_start_key,sum(age/86400) age
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where   -- week_start_key='20180122' and a12.full_name='Aakanksha Sharma' and  priority_src_key=54610 and business_service_key= 49 and 
 week_start_key>=20180101 and week_start_key<=20180305 
group by 1 ,2,3,4,5,6,7,8)a
join
(
select assigned_to_key,a12.full_name,a12.vendor_name_c, a12.grouped_vendor_name_c  ,priority_src_key,business_service_key, prev_week_start_key,week_start_key,sum((prev_age/86400)) prev_age
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where   -- prev_week_start_key='20180122' and a12.full_name='Aakanksha Sharma' and  priority_src_key=54610 and business_service_key= 49 and 
 prev_week_start_key>=20180101 and prev_week_start_key<=20180305 
group by 1 ,2,3,4,5,6,7,8)b

on  a.week_start_key=b.prev_week_start_key 
where  a.assigned_to_key=b.assigned_to_key and
 a.priority_src_key=b.priority_src_key
and a.business_service_key=b.business_service_key 
and a.week_start_key>=20180101 and a.week_start_key<=20180305 
 -- and prev_age not in (0) and
and  (age)<>(prev_age) ;														
														
	at week level compare for   INFLOW with dba and cube
													
														
     select a.week_start_key,b.prev_week_start_key,inflow,prev_inflow from (
select week_start_key,sum(inflow_count) inflow
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  week_start_key>=20180101 and week_start_key<=20180326
group by 1)a 
join (
select prev_week_start_key,sum(prev_inflow_count) prev_inflow   
FROM     mcdonalds_mdwdb.f_n_incident_vdr_io_snapshot_weekly_c
Join mcdonalds_mdwdb.d_internal_contact a12 ON assigned_to_key = a12.row_key
where  prev_week_start_key>=20180101 and prev_week_start_key<=20180326
group by 1 )b 
on   a.week_start_key=b.prev_week_start_key where inflow=prev_inflow														
														
														
														
														
														
														
														
														
														
														
														
														
							
									
									
									
									
									
									
									
									
									
																
																
																
																
																
																
																

																
																
																
																

																	
																	
																	
																	
																	

																	
																	